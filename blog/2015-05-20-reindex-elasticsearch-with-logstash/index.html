<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Reindex elasticsearch with Logstash - David Pilato</title><meta name=generator content="Hugo Eureka 0.9.3"><link rel=stylesheet href=https://david.pilato.fr/css/eureka.min.9cec6350e37e534b0338fa9a085bf06855de3b0f2dcf857e792e5e97b07ea905d4d5513db554cbc26a9c3da622bae92d.css><script defer src=https://david.pilato.fr/js/eureka.min.c9397561036ecdb150468028e7807081e0823ad4b7207798ac3c0cdf9742e4300265511b6b457026c9a0e7b663e44683.js></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload="this.onload=null,this.rel='stylesheet'"><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/solarized-light.min.css media=print onload="this.media='all',this.onload=null" crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script>
<link rel=stylesheet href=https://david.pilato.fr/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload="this.media='all',this.onload=null"><script defer type=text/javascript src=https://david.pilato.fr/js/fontawesome.min.3b3a9010e96bcc23aa7ff4cef43506624c34c13b18fd1c67fe5138e9a95657d5f58ac4aebc370d569554fca0aedd65c5.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload="this.media='all',this.onload=null" crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script>
<link rel=preconnect href=https://www.google-analytics.com crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=UA-62381049-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-62381049-1')</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/featured.png"><meta name=twitter:title content="Reindex elasticsearch with Logstash"><meta name=twitter:description content="Sometimes, you would like to reindex your data to change your mapping or to change your index settings or to move from one server to another or to one cluster to another (think about multiple data centers for example).
For the later you can use Snapshot and Restore feature but if you need to change any index settings, you need something else.
With Logstash 1.5.0, you can now do it super easily using elasticsearch input and elasticsearch output."><meta name=description content="Sometimes, you would like to reindex your data to change your mapping or to change your index settings or to move from one server to another or to one cluster to another (think about multiple data centers for example).
For the later you can use Snapshot and Restore feature but if you need to change any index settings, you need something else.
With Logstash 1.5.0, you can now do it super easily using elasticsearch input and elasticsearch output."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://david.pilato.fr/blog/"},{"@type":"ListItem","position":2,"name":"Reindex elasticsearch with Logstash","item":"https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/"},"headline":"Reindex elasticsearch with Logstash - David Pilato","image":"https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/featured.png","datePublished":"2015-05-20T11:03:29+02:00","dateModified":"2015-05-20T11:03:29+02:00","wordCount":1022,"author":{"@type":"Person","name":["David Pilato"]},"publisher":{"@type":"Person","name":"David Pilato"},"description":"Sometimes, you would like to reindex your data to change your mapping or to change your index settings or to move from one server to another or to one cluster to another (think about multiple data centers for example).\nFor the later you can use Snapshot and Restore feature but if you need to change any index settings, you need something else.\nWith Logstash 1.5.0, you can now do it super easily using elasticsearch input and elasticsearch output."}</script><meta property="og:title" content="Reindex elasticsearch with Logstash - David Pilato"><meta property="og:type" content="article"><meta property="og:url" content="https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/"><meta property="og:description" content="Sometimes, you would like to reindex your data to change your mapping or to change your index settings or to move from one server to another or to one cluster to another (think about multiple data centers for example).
For the later you can use Snapshot and Restore feature but if you need to change any index settings, you need something else.
With Logstash 1.5.0, you can now do it super easily using elasticsearch input and elasticsearch output."><meta property="og:locale" content="en"><meta property="og:site_name" content="David Pilato"><meta property="article:published_time" content="2015-05-20T11:03:29+02:00"><meta property="article:modified_time" content="2015-05-20T11:03:29+02:00"><meta property="article:section" content="blog"><meta property="article:tag" content="elasticsearch"><meta property="article:tag" content="logstash"><meta property="article:tag" content="reindex"><meta property="og:see_also" content="https://david.pilato.fr/blog/2015-05-02-devoxx-france-2015/"><meta property="og:see_also" content="https://david.pilato.fr/blog/2015-04-28-exploring-capitaine-train-dataset/"><meta property="og:see_also" content="https://david.pilato.fr/blog/2015-05-19-using-js-auth-with-found-cluster/"><meta property="og:see_also" content="https://david.pilato.fr/blog/2015-05-09-advanced-search-for-your-legacy-application/"><meta property="og:see_also" content="https://david.pilato.fr/blog/2012-07-20-scrutmydocs-un-moteur-de-recherche-pour-documents/"><meta property="og:see_also" content="https://david.pilato.fr/blog/2012-05-25-la-factory-spring-pour-elasticsearch-est-sortie/"><body class="flex flex-col min-h-screen"><header class="fixed flex items-center w-full min-h-16 pl-scrollbar z-50 bg-secondary-bg shadow-sm"><div class="w-full max-w-screen-xl mx-auto"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=='Auto'||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName('html')[0].classList.add('dark')</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="me-6 text-primary-text text-xl font-bold">David Pilato</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">Home</a>
<a href=/blog/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">Blog</a>
<a href=https://djdadoo.pilato.fr/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">DJ Mixes</a>
<a href=/authors/david-pilato/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">About me</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById('lightDarkMode');storageColorScheme==null||storageColorScheme=='Auto'?document.addEventListener('DOMContentLoaded',()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change',switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'sun'),element.firstElementChild.classList.add('fa-sun')):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'moon'),element.firstElementChild.classList.add('fa-moon')),document.addEventListener('DOMContentLoaded',()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="flex-grow pt-16"><div class=pl-scrollbar><div class="w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class=prose><h1 class=mb-4>Reindex elasticsearch with Logstash</h1><div class="flex flex-wrap flex-row items-center mt-2 text-tertiary-text"><div class="mr-6 my-2"><i class="fas fa-calendar-alt mr-1"></i>
<span>2015-05-20</span></div><div class="mr-6 my-2"><i class="fas fa-folder mr-1"></i> <a href=https://david.pilato.fr/categories/tutorial/ class=hover:text-eureka>tutorial</a></div></div><img src=https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/featured.png class=w-full alt="Featured Image"><p>Sometimes, you would like to reindex your data to change your mapping or to change your index settings or to move from one server to another or to one cluster to another (think about multiple data centers for example).</p><p>For the later you can use <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-snapshots.html>Snapshot and Restore</a> feature but if you need to change any index settings, you need something else.</p><p>With Logstash <a href=https://www.elastic.co/blog/logstash-1-5-0-ga-released>1.5.0</a>, you can now do it super easily using <a href=https://www.elastic.co/guide/en/logstash/current/plugins-inputs-elasticsearch.html>elasticsearch input</a> and <a href=https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html>elasticsearch output</a>.</p><p>Let&rsquo;s do it!</p><h2 id=the-old-cluster>The old cluster</h2><p>Let&rsquo;s say you have already elasticsearch 1.5.2 up and running on <code>localhost:9200</code> with cluster name <code>old</code>.</p><pre><code class=language-sh>bin/elasticsearch --cluster.name=old
</code></pre><p>The cluster has an existing index named <code>person</code>. It has 5 shards and 1 million documents.</p><figure><img src=sense01.png alt=sense><figcaption><p>sense</p></figcaption></figure><h2 id=the-new-cluster>The new cluster</h2><p>Let&rsquo;s start a new cluster. It will run on <code>localhost:9201</code> with cluster name <code>new</code>:</p><pre><code class=language-sh>bin/elasticsearch --cluster.name=new
</code></pre><p>It&rsquo;s empty:</p><pre><code class=language-sh>curl -XGET &quot;http://localhost:9201/person&quot;
</code></pre><pre><code class=language-json>{
   &quot;error&quot;: &quot;IndexMissingException[[person] missing]&quot;,
   &quot;status&quot;: 404
}
</code></pre><h2 id=installing-logstash>Installing logstash</h2><p>So let&rsquo;s download and install logstash 1.5.0:</p><pre><code class=language-sh>wget http://download.elastic.co/logstash/logstash/logstash-1.5.0.tar.gz
tar xzf logstash-1.5.0.tar.gz
cd logstash-1.5.0
</code></pre><p>Now we can define our logstash config file <code>logstash.conf</code>:</p><pre><code class=language-ruby>input {
  # We read from the &quot;old&quot; cluster
  elasticsearch {
    hosts =&gt; [ &quot;localhost&quot; ]
    port =&gt; &quot;9200&quot;
    index =&gt; &quot;person&quot;
    size =&gt; 500
    scroll =&gt; &quot;5m&quot;
    docinfo =&gt; true
  }
}

output {
  # We write to the &quot;new&quot; cluster
  elasticsearch {
    host =&gt; &quot;localhost&quot;
    port =&gt; &quot;9201&quot;
    protocol =&gt; &quot;http&quot;
    index =&gt; &quot;%{[@metadata][_index]}&quot;
    index_type =&gt; &quot;%{[@metadata][_type]}&quot;
    document_id =&gt; &quot;%{[@metadata][_id]}&quot;
  }
  # We print dots to see it in action
  stdout {
    codec =&gt; &quot;dots&quot;
  }
}
</code></pre><h2 id=run-and-fix>Run and fix</h2><p>Run it:</p><pre><code class=language-sh>bin/logstash -f logstash.conf
</code></pre><h3 id=check-and-fix-documents>Check and fix documents</h3><p>What does it produce?</p><pre><code class=language-sh>curl -XGET &quot;http://localhost:9200/person/person/AU1wqyQWZJKU8OibfxgH&quot;
</code></pre><pre><code class=language-json>{
   &quot;_index&quot;: &quot;person&quot;,
   &quot;_type&quot;: &quot;person&quot;,
   &quot;_id&quot;: &quot;AU1wqyQWZJKU8OibfxgH&quot;,
   &quot;_version&quot;: 1,
   &quot;found&quot;: true,
   &quot;_source&quot;: {
      &quot;name&quot;: &quot;Tali Elyne&quot;,
      &quot;dateOfBirth&quot;: &quot;1955-05-03&quot;,
      &quot;gender&quot;: &quot;female&quot;,
      &quot;children&quot;: 2,
      &quot;marketing&quot;: {
         &quot;cars&quot;: null,
         &quot;shoes&quot;: null,
         &quot;toys&quot;: null,
         &quot;fashion&quot;: null,
         &quot;music&quot;: null,
         &quot;garden&quot;: null,
         &quot;electronic&quot;: null,
         &quot;hifi&quot;: null,
         &quot;food&quot;: 846
      },
      &quot;address&quot;: {
         &quot;country&quot;: &quot;Germany&quot;,
         &quot;zipcode&quot;: &quot;0099&quot;,
         &quot;city&quot;: &quot;Bonn&quot;,
         &quot;countrycode&quot;: &quot;DE&quot;,
         &quot;location&quot;: [
            7.075943707068682,
            50.72883500730124
         ]
      }
   }
}
</code></pre><p>Let&rsquo;s compare that with the other cluster:</p><pre><code class=language-sh>curl -XGET &quot;http://localhost:9201/person/person/AU1wqyQWZJKU8OibfxgH&quot;
</code></pre><pre><code class=language-json>{
   &quot;_index&quot;: &quot;person&quot;,
   &quot;_type&quot;: &quot;person&quot;,
   &quot;_id&quot;: &quot;AU1wqyQWZJKU8OibfxgH&quot;,
   &quot;_version&quot;: 1,
   &quot;found&quot;: true,
   &quot;_source&quot;: {
      &quot;name&quot;: &quot;Tali Elyne&quot;,
      &quot;dateOfBirth&quot;: &quot;1955-05-03&quot;,
      &quot;gender&quot;: &quot;female&quot;,
      &quot;children&quot;: 2,
      &quot;marketing&quot;: {
         &quot;cars&quot;: null,
         &quot;shoes&quot;: null,
         &quot;toys&quot;: null,
         &quot;fashion&quot;: null,
         &quot;music&quot;: null,
         &quot;garden&quot;: null,
         &quot;electronic&quot;: null,
         &quot;hifi&quot;: null,
         &quot;food&quot;: 846
      },
      &quot;address&quot;: {
         &quot;country&quot;: &quot;Germany&quot;,
         &quot;zipcode&quot;: &quot;0099&quot;,
         &quot;city&quot;: &quot;Bonn&quot;,
         &quot;countrycode&quot;: &quot;DE&quot;,
         &quot;location&quot;: [
            7.075943707068682,
            50.72883500730124
         ]
      },
      &quot;@version&quot;: &quot;1&quot;,
      &quot;@timestamp&quot;: &quot;2015-05-20T09:53:44.089Z&quot;
   }
}
</code></pre><p>Logstash has just added <code>@version</code> and <code>@timestamp</code> fields. We might want to filter them out using <a href=http://www.elastic.co/guide/en/logstash/current/plugins-filters-mutate.html>Mutate filter plugin</a> and its <a href=http://www.elastic.co/guide/en/logstash/current/plugins-filters-mutate.html#plugins-filters-mutate-remove_field>remove_field</a>:</p><pre><code class=language-ruby>filter {
  mutate {
    remove_field =&gt; [ &quot;@timestamp&quot;, &quot;@version&quot; ]
  }
}
</code></pre><h3 id=check-and-fix-mapping>Check and fix mapping</h3><p>Actually, logstash reads here the <code>_source</code> field from existing documents and reinject them directly into a new cluster. But logstash does not take care at all about mappings.</p><p>If we compare the old mapping and the new one, here is what we get:</p><pre><code class=language-sh>curl -XGET &quot;http://localhost:9200/person/person/_mapping&quot;
</code></pre><pre><code class=language-json>{
   &quot;person&quot;: {
      &quot;mappings&quot;: {
         &quot;person&quot;: {
            &quot;properties&quot;: {
               &quot;address&quot;: {
                  &quot;properties&quot;: {
                     &quot;city&quot;: {
                        &quot;type&quot;: &quot;string&quot;,
                        &quot;index&quot;: &quot;not_analyzed&quot;
                     },
                     &quot;country&quot;: {
                        &quot;type&quot;: &quot;string&quot;,
                        &quot;index&quot;: &quot;not_analyzed&quot;
                     },
                     &quot;countrycode&quot;: {
                        &quot;type&quot;: &quot;string&quot;,
                        &quot;index&quot;: &quot;not_analyzed&quot;
                     },
                     &quot;location&quot;: {
                        &quot;type&quot;: &quot;geo_point&quot;
                     },
                     &quot;zipcode&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                     }
                  }
               },
               &quot;children&quot;: {
                  &quot;type&quot;: &quot;long&quot;
               },
               &quot;dateOfBirth&quot;: {
                  &quot;type&quot;: &quot;date&quot;,
                  &quot;format&quot;: &quot;dateOptionalTime&quot;
               },
               &quot;gender&quot;: {
                  &quot;type&quot;: &quot;string&quot;,
                  &quot;index&quot;: &quot;not_analyzed&quot;
               },
               &quot;marketing&quot;: {
                  &quot;properties&quot;: {
                     &quot;cars&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;electronic&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;fashion&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;food&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;garden&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;hifi&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;music&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;shoes&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;toys&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     }
                  }
               },
               &quot;name&quot;: {
                  &quot;type&quot;: &quot;string&quot;
               }
            }
         }
      }
   }
}
</code></pre><pre><code class=language-sh>curl -XGET &quot;http://localhost:9201/person/person/_mapping&quot;
</code></pre><pre><code class=language-json>{
   &quot;person&quot;: {
      &quot;mappings&quot;: {
         &quot;person&quot;: {
            &quot;properties&quot;: {
               &quot;address&quot;: {
                  &quot;properties&quot;: {
                     &quot;city&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                     },
                     &quot;country&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                     },
                     &quot;countrycode&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                     },
                     &quot;location&quot;: {
                        &quot;type&quot;: &quot;double&quot;
                     },
                     &quot;zipcode&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                     }
                  }
               },
               &quot;children&quot;: {
                  &quot;type&quot;: &quot;long&quot;
               },
               &quot;dateOfBirth&quot;: {
                  &quot;type&quot;: &quot;date&quot;,
                  &quot;format&quot;: &quot;dateOptionalTime&quot;
               },
               &quot;gender&quot;: {
                  &quot;type&quot;: &quot;string&quot;
               },
               &quot;marketing&quot;: {
                  &quot;properties&quot;: {
                     &quot;cars&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;electronic&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;fashion&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;food&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;garden&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;hifi&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;music&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;shoes&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     },
                     &quot;toys&quot;: {
                        &quot;type&quot;: &quot;long&quot;
                     }
                  }
               },
               &quot;name&quot;: {
                  &quot;type&quot;: &quot;string&quot;
               }
            }
         }
      }
   }
}
</code></pre><p>We can see some obvious differences!</p><pre><code class=language-json> &quot;location&quot;: {
    &quot;type&quot;: &quot;geo_point&quot;
 }
</code></pre><pre><code class=language-json> &quot;location&quot;: {
    &quot;type&quot;: &quot;double&quot;
 }
</code></pre><p>So we can fix that by creating first the mapping we want to apply before indexing any data. At this point you can obviously change the original mapping to whatever you want. For example, change an analyzer.
You can also define new settings for your index. By default, elasticsearch creates 5 shards and 1 replica for each shard. But once again, you can control that:</p><pre><code class=language-sh>curl -XDELETE &quot;http://localhost:9201/person&quot;
curl -XPUT &quot;http://localhost:9201/person&quot; -d'
{
  &quot;settings&quot;: {
    &quot;number_of_shards&quot;: 1,
    &quot;number_of_replicas&quot;: 0
  }
}'
curl -XPUT &quot;http://localhost:9201/person/person/_mapping&quot; -d'
{
  &quot;person&quot;: {
    &quot;properties&quot;: {
      &quot;address&quot;: {
        &quot;properties&quot;: {
          &quot;city&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;index&quot;: &quot;not_analyzed&quot;
          },
          &quot;country&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;index&quot;: &quot;not_analyzed&quot;
          },
          &quot;countrycode&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;index&quot;: &quot;not_analyzed&quot;
          },
          &quot;location&quot;: {
            &quot;type&quot;: &quot;geo_point&quot;
          },
          &quot;zipcode&quot;: {
            &quot;type&quot;: &quot;string&quot;
          }
        }
      },
      &quot;children&quot;: {
        &quot;type&quot;: &quot;long&quot;
      },
      &quot;dateOfBirth&quot;: {
        &quot;type&quot;: &quot;date&quot;,
        &quot;format&quot;: &quot;dateOptionalTime&quot;
      },
      &quot;gender&quot;: {
        &quot;type&quot;: &quot;string&quot;,
        &quot;index&quot;: &quot;not_analyzed&quot;
      },
      &quot;marketing&quot;: {
        &quot;properties&quot;: {
          &quot;cars&quot;: {
            &quot;type&quot;: &quot;long&quot;
          },
          &quot;electronic&quot;: {
            &quot;type&quot;: &quot;long&quot;
          },
          &quot;fashion&quot;: {
            &quot;type&quot;: &quot;long&quot;
          },
          &quot;food&quot;: {
            &quot;type&quot;: &quot;long&quot;
          },
          &quot;garden&quot;: {
            &quot;type&quot;: &quot;long&quot;
          },
          &quot;hifi&quot;: {
            &quot;type&quot;: &quot;long&quot;
          },
          &quot;music&quot;: {
            &quot;type&quot;: &quot;long&quot;
          },
          &quot;shoes&quot;: {
            &quot;type&quot;: &quot;long&quot;
          },
          &quot;toys&quot;: {
            &quot;type&quot;: &quot;long&quot;
          }
        }
      },
      &quot;name&quot;: {
        &quot;type&quot;: &quot;string&quot;
      }
    }
  }
}'
</code></pre><p>And now, you can reindex your data again!</p><pre><code class=language-sh>bin/logstash -f logstash.conf
</code></pre><figure><img src=sense02.png alt=sense><figcaption><p>sense</p></figcaption></figure><h2 id=changing-index-or-type-names>Changing index or type names</h2><p>Note that you can of course reindex in another index name if you want to, change the type name, even the id! 😀</p><pre><code class=language-ruby>  elasticsearch {
    host =&gt; &quot;localhost&quot;
    port =&gt; &quot;9201&quot;
    protocol =&gt; &quot;http&quot;
    index =&gt; &quot;europe_people&quot;
    index_type =&gt; &quot;someone&quot;
    document_id =&gt; &quot;%{[@metadata][_id]}&quot;
  }
</code></pre></article><div class=my-4><a href=https://david.pilato.fr/tags/elasticsearch/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#elasticsearch</a>
<a href=https://david.pilato.fr/tags/logstash/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#logstash</a>
<a href=https://david.pilato.fr/tags/reindex/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#reindex</a></div><div class="flex md:justify-end my-4"><style>#share-buttons{display:inline-block;vertical-align:middle}#share-buttons:after{content:"";display:block;clear:both}#share-buttons>div{position:relative;text-align:left;height:36px;width:32px;float:left;text-align:center}#share-buttons>div>svg{height:16px;fill:#000;margin-top:10px}#share-buttons>div:hover{cursor:pointer}#share-buttons>div.facebook:hover>svg{fill:#3b5998}#share-buttons>div.twitter:hover>svg{fill:#55acee}#share-buttons>div.linkedin:hover>svg{fill:#0077b5}#share-buttons>div.pinterest:hover>svg{fill:#cb2027}#share-buttons>div.mail:hover>svg{fill:#7d7d7d}#share-buttons>div.facebook>svg{height:18px;margin-top:9px}#share-buttons>div.twitter>svg{height:20px;margin-top:8px}#share-buttons>div.linkedin>svg{height:19px;margin-top:7px}#share-buttons>div.pinterest>svg{height:20px;margin-top:9px}#share-buttons>div.mail>svg{height:14px;margin-top:11px}</style><div id=share-buttons><div class=facebook title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/')"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"/></svg></div><div class=twitter title="Share this on Twitter" onclick="window.open('http://twitter.com/intent/tweet?via=dadoonet&text=🧑🏼‍💻 Blog: Reindex elasticsearch with Logstash 👉🏼&url=https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/')"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5T1369.5 1125 1185 1335.5t-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5T285 1033q33 5 61 5 43 0 85-11-112-23-185.5-111.5T172 710v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5T884 653q-8-38-8-74 0-134 94.5-228.5T1199 256q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div><div class=linkedin title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/&title=&summary=&source=')"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"/></svg></div><div class=mail title="Share this through Email" onclick="window.open('mailto:?&body=https://david.pilato.fr/blog/2015-05-20-reindex-elasticsearch-with-logstash/')"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47H160q-66 0-113-47T0 1504V710q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 1e2-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38T639 1015q-91-64-262-182.5T172 690q-62-42-117-115.5T0 438q0-78 41.5-130T160 256h1472q65 0 112.5 47t47.5 113z"/></svg></div></div><a href=https://github.com/dadoonet/dadoonet.github.io/tree/main/content/blog/2015-05-20-reindex-elasticsearch-with-logstash/index.md title="Edit this page"><i class="fas fa-edit mr-1"></i></a></div><div class=py-2><div class="my-8 flex flex-col items-center md:flex-row"><a href=https://david.pilato.fr/authors/david-pilato/ class="md:me-4 text-primary-text h-24 w-24"><img src=https://david.pilato.fr/authors/david-pilato/david_pilato.png class="bg-primary-bg w-full rounded-full" alt=Avatar></a><div class="mt-4 w-full md:mt-0 md:w-auto"><a href=https://david.pilato.fr/authors/david-pilato/ class="mb-2 block border-b pb-1 text-lg font-bold"><h3>David Pilato</h3></a><span class="block pb-2">20+ years of experience, mostly in Java. Living in Cergy, France.</span>
<a href=mailto:david+blog@pilato.fr class=me-2><i class="fas fa-envelope"></i></a>
<a href=https://twitter.com/dadoonet class=me-2><i class="fab fa-twitter"></i></a>
<a href=https://github.com/dadoonet class=me-2><i class="fab fa-github"></i></a>
<a href=https://www.linkedin.com/in/dadoonet/ class=me-2><i class="fab fa-linkedin"></i></a></div></div></div><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">Previous</span>
<a href=https://david.pilato.fr/blog/2015-06-01-indexing-twitter-with-logstash-and-elasticsearch/ class=block>Indexing Twitter with Logstash and Elasticsearch</a></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">Next</span>
<a href=https://david.pilato.fr/blog/2015-05-19-using-js-auth-with-found-cluster/ class=block>Using JS Auth with found cluster</a></div></div><script id=utterances src=https://utteranc.es/client.js issue-term=pathname label=💬 comments repo=dadoonet/dadoonet.github.io theme=preferred-color-scheme crossorigin=anonymous async></script><script>storageColorScheme=="Light"?document.getElementById('utterances').setAttribute('theme','github-light'):storageColorScheme=="Dark"&&document.getElementById('utterances').setAttribute('theme','github-dark')</script></div><div class=col-span-2><div class="bg-primary-bg
prose sticky top-16 z-10 hidden px-6 py-4 lg:block"><h3>On This Page</h3></div><div class="sticky-toc hidden px-6 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#the-old-cluster>The old cluster</a></li><li><a href=#the-new-cluster>The new cluster</a></li><li><a href=#installing-logstash>Installing logstash</a></li><li><a href=#run-and-fix>Run and fix</a><ul><li><a href=#check-and-fix-documents>Check and fix documents</a></li><li><a href=#check-and-fix-mapping>Check and fix mapping</a></li></ul></li><li><a href=#changing-index-or-type-names>Changing index or type names</a></li></ul></nav></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div><div class="bg-secondary-bg prose col-span-2 rounded p-6 lg:col-span-6"><h3>See Also</h3><a href=https://david.pilato.fr/blog/2015-05-02-devoxx-france-2015/ class=no-underline>Devoxx France 2015</a><br><a href=https://david.pilato.fr/blog/2015-04-28-exploring-capitaine-train-dataset/ class=no-underline>Exploring Capitaine Train dataset</a><br><a href=https://david.pilato.fr/blog/2015-05-19-using-js-auth-with-found-cluster/ class=no-underline>Using JS Auth with found cluster</a><br><a href=https://david.pilato.fr/blog/2015-05-09-advanced-search-for-your-legacy-application/ class=no-underline>Advanced search for your Legacy application</a><br><a href=https://david.pilato.fr/blog/2012-07-20-scrutmydocs-un-moteur-de-recherche-pour-documents/ class=no-underline>ScrutMyDocs : un moteur de recherche pour documents</a><br><a href=https://david.pilato.fr/blog/2012-05-25-la-factory-spring-pour-elasticsearch-est-sortie/ class=no-underline>La factory Spring pour Elasticsearch est sortie !</a><br></div></div><script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script></div></div></main><footer class=pl-scrollbar><div class="w-full max-w-screen-xl mx-auto"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2022, David Pilato, France
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div><div class="text-center p-1 pin-b"><p class="text-sm text-tertiary-text">Generated from 🇫🇷 with ❤️ on Tue Jun 14, 2022 at 12:48:10 UTC</p></div></div></footer></body></html>