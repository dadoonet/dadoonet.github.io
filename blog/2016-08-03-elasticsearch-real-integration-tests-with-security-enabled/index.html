<!doctype html><html lang=en><meta charset=utf-8>
<meta name=viewport content="width=device-width">
<title>Elasticsearch real integration tests with security enabled | David Pilato</title>
<meta name=generator content="Hugo Eureka 0.8.4">
<link rel=stylesheet href=https://david.pilato.fr/css/eureka.min.css>
<script defer src=https://david.pilato.fr/js/eureka.min.js></script>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload="this.onload=null,this.rel='stylesheet'">
<link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/styles/solarized-light.min.css media=print onload="this.media='all',this.onload=null" crossorigin>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/highlight.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/js/all.min.js integrity="sha256-uNYoXefWRqv+PsIF/OflNmwtKM4lStn9yrz2gVl6ymo=" crossorigin></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X media=print onload="this.media='all',this.onload=null" crossorigin>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
<script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js integrity="sha256-Zmpaaj+GXFsPF5WdPArSrnW3b30dovldeKsW00xBVwE=" crossorigin></script>
<meta name=description content="NOTE: This article is now outdated. Please read Elasticsearch real integration tests with security enabled (Updated for GA) instead!
In a recent post we have seen how to create real integration tests. Those tests launch a real elasticsearch cluster, then run some tests you write with JUnit or your favorite test framework then stop the cluster.
But sometimes, you may want to add existing plugins in your integration test cluster.
For example, you might want to use X-Pack to bring fantastic features such as:">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://david.pilato.fr/blog/"},{"@type":"ListItem","position":2,"name":"Elasticsearch real integration tests with security enabled","item":"https://david.pilato.fr/blog/2016-08-03-elasticsearch-real-integration-tests-with-security-enabled/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://david.pilato.fr/blog/2016-08-03-elasticsearch-real-integration-tests-with-security-enabled/"},"headline":"Elasticsearch real integration tests with security enabled | David Pilato","datePublished":"2016-08-03T18:24:37+02:00","dateModified":"2016-08-03T18:24:37+02:00","wordCount":1492,"author":{"@type":"Person","name":["David Pilato"]},"publisher":{"@type":"Person","name":"David Pilato"},"description":"NOTE: This article is now outdated. Please read Elasticsearch real integration tests with security enabled (Updated for GA) instead!\nIn a recent post we have seen how to create real integration tests. Those tests launch a real elasticsearch cluster, then run some tests you write with JUnit or your favorite test framework then stop the cluster.\nBut sometimes, you may want to add existing plugins in your integration test cluster.\nFor example, you might want to use X-Pack to bring fantastic features such as:"}</script><meta property="og:title" content="Elasticsearch real integration tests with security enabled | David Pilato">
<meta property="og:type" content="article">
<meta property="og:url" content="https://david.pilato.fr/blog/2016-08-03-elasticsearch-real-integration-tests-with-security-enabled/">
<meta property="og:description" content="NOTE: This article is now outdated. Please read Elasticsearch real integration tests with security enabled (Updated for GA) instead!
In a recent post we have seen how to create real integration tests. Those tests launch a real elasticsearch cluster, then run some tests you write with JUnit or your favorite test framework then stop the cluster.
But sometimes, you may want to add existing plugins in your integration test cluster.
For example, you might want to use X-Pack to bring fantastic features such as:">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="David Pilato">
<meta property="article:published_time" content="2016-08-03T18:24:37+02:00">
<meta property="article:modified_time" content="2016-08-03T18:24:37+02:00">
<meta property="article:section" content="blog">
<meta property="article:tag" content="java">
<meta property="article:tag" content="maven">
<meta property="article:tag" content="ant">
<meta property="article:tag" content="elasticsearch">
<meta property="article:tag" content="plugin">
<meta property="og:see_also" content="https://david.pilato.fr/blog/2016-08-01-creating-elasticsearch-transport-action/">
<meta property="og:see_also" content="https://david.pilato.fr/blog/2016-07-30-adding-a-new-rest-endpoint-to-elasticsearch/">
<meta property="og:see_also" content="https://david.pilato.fr/blog/2016-07-29-elasticsearch-real-integration-tests/">
<meta property="og:see_also" content="https://david.pilato.fr/blog/2016-07-28-creating-an-ingest-plugin-for-elasticsearch/">
<meta property="og:see_also" content="https://david.pilato.fr/blog/2016-07-27-creating-a-plugin-for-elasticsearch-5-dot-0-using-maven/">
<body class="flex flex-col min-h-screen">
<header class="fixed flex items-center w-full min-h-16 pl-scrollbar z-50 bg-secondary-bg shadow-sm">
<div class="w-full max-w-screen-xl mx-auto"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=='Auto'||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName('html')[0].classList.add('dark')</script>
<nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0">
<a href=/ class="mr-6 text-primary-text text-xl font-bold">David Pilato</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i>
</button>
<div id=target class="hidden block md:flex md:flex-grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20">
<div class="md:flex md:h-16 text-sm md:flex-grow pb-4 md:pb-0 border-b md:border-b-0">
<a href=/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item mr-4">Home</a>
<a href=/blog/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item mr-4">Blog</a>
<a href=https://djdadoo.pilato.fr/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent mr-4">DJ Mixes</a>
<a href=/authors/david-pilato/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent mr-4">About me</a>
</div>
<div class=flex>
<div class="relative pt-4 md:pt-0">
<div class="cursor-pointer hover:text-eureka" id=lightDarkMode>
<i class="fas fa-adjust"></i>
</div>
<div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open>
</div>
<div class="absolute flex flex-col left-0 md:left-auto right-auto md:right-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions>
<span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span>
</div>
</div>
</div>
</div>
<div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile>
</div>
</nav>
<script>let element=document.getElementById('lightDarkMode');storageColorScheme==null||storageColorScheme=='Auto'?document.addEventListener('DOMContentLoaded',()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change',switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'sun'),element.firstElementChild.classList.add('fa-sun')):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove('fa-adjust'),element.firstElementChild.setAttribute("data-icon",'moon'),element.firstElementChild.classList.add('fa-moon')),document.addEventListener('DOMContentLoaded',()=>{getcolorscheme(),switchBurger()})</script>
</div>
</header>
<main class="flex-grow pt-16">
<div class=pl-scrollbar>
<div class="w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto">
<div class="grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12">
<div class="col-span-2 lg:col-span-6 bg-secondary-bg rounded px-6 py-8">
<h1 class="font-bold text-3xl text-primary-text">Elasticsearch real integration tests with security enabled</h1>
<div class="flex flex-wrap flex-row items-center mt-2 text-tertiary-text">
<div class="mr-6 my-2">
<i class="fas fa-calendar mr-1"></i>
<span>2016-08-03</span>
</div>
<div class="mr-6 my-2">
<i class="fas fa-clock mr-1"></i>
<span>8 min read</span>
</div>
<div class="mr-6 my-2">
<i class="fas fa-folder mr-1"></i>
<a href=https://david.pilato.fr/categories/tutorial/ class=hover:text-eureka>tutorial</a>
</div>
<div class="mr-6 my-2">
<i class="fas fa-th-list mr-1"></i>
<a href=https://david.pilato.fr/series/plugin-for-elasticsearch-v5/ class=hover:text-eureka>plugin for elasticsearch v5</a>
</div>
</div>
<div class=content>
<p><strong>NOTE:</strong> This article is now outdated. Please read <a href=https://david.pilato.fr/blog/2016-10-21-elasticsearch-real-integration-tests-with-security-enabled-updated-for-ga/>Elasticsearch real integration tests with security enabled (Updated for GA)</a> instead!</p>
<p>In a recent post we have seen <a href=https://david.pilato.fr/blog/2016-07-29-elasticsearch-real-integration-tests/>how to create real integration tests</a>.
Those tests launch a real elasticsearch cluster, then run some tests you write with JUnit or your favorite test framework
then stop the cluster.</p>
<p>But sometimes, you may want to add existing plugins in your integration test cluster.</p>
<p>For example, you might want to use <a href=https://www.elastic.co/downloads/x-pack>X-Pack</a> to bring fantastic features such as:</p>
<ul>
<li>Security</li>
<li>Alerting</li>
<li>Monitoring</li>
<li>Graph</li>
<li>Reporting</li>
</ul>
<p>Let&rsquo;s see how you can do that with Maven and Ant again&mldr;</p>
<h2 id=copy-the-plugins-from-maven-central>Copy the plugins from maven central</h2>
<p>We can add a new <code>execution</code> to the <code>maven-dependency-plugin</code> we already defined.
The goal is to copy all plugins we need to a <code>target/integration-tests/plugins</code> directory.</p>
<pre><code class=language-xml>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.10&lt;/version&gt;
    &lt;executions&gt;
        &lt;!-- ... --&gt;
        &lt;execution&gt;
            &lt;id&gt;integ-setup-dependencies-plugins&lt;/id&gt;
            &lt;phase&gt;pre-integration-test&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;copy&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;skip&gt;${skipIntegTests}&lt;/skip&gt;
                &lt;artifactItems&gt;
                    &lt;artifactItem&gt;
                        &lt;groupId&gt;org.elasticsearch.plugin&lt;/groupId&gt;
                        &lt;artifactId&gt;x-pack&lt;/artifactId&gt;
                        &lt;version&gt;${elasticsearch.version}&lt;/version&gt;
                        &lt;type&gt;zip&lt;/type&gt;
                    &lt;/artifactItem&gt;
                &lt;/artifactItems&gt;
                &lt;useBaseVersion&gt;true&lt;/useBaseVersion&gt;
                &lt;outputDirectory&gt;${project.build.directory}/integration-tests/plugins&lt;/outputDirectory&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre>
<p>Here we are just copying <code>x-pack</code> but you can add <a href=https://www.elastic.co/guide/en/elasticsearch/plugins/master/index.html>as many plugins</a>
as you need.</p>
<h2 id=modify-ant-scripts>Modify ANT scripts</h2>
<p>First we will need some additional features for ANT so we add <code>ant-contrib</code>
in <code>maven-antrun-plugin</code>:</p>
<pre><code class=language-xml>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.8&lt;/version&gt;
    &lt;!-- ... --&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ant-contrib&lt;/groupId&gt;
            &lt;artifactId&gt;ant-contrib&lt;/artifactId&gt;
            &lt;version&gt;1.0b3&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;ant&lt;/groupId&gt;
                    &lt;artifactId&gt;ant&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/plugin&gt;
</code></pre>
<p>In out ANT script, we add in the header:</p>
<pre><code class=language-xml>&lt;project name=&quot;integration-tests&quot;
         xmlns:if=&quot;ant:if&quot;
         xmlns:unless=&quot;ant:unless&quot;
         xmlns:ac=&quot;antlib:net.sf.antcontrib&quot;&gt;
</code></pre>
<h3 id=install-other-plugins>Install other plugins</h3>
<p>We need first to extract the plugin name from its file name.
I used the great <a href=https://regex101.com/>regex101 online tester</a> tool to find the right
regular expression and came to:</p>
<pre><code class=language-xml>&lt;taskdef resource=&quot;net/sf/antcontrib/antcontrib.properties&quot; /&gt;

&lt;macrodef name=&quot;convert-plugin-name&quot;&gt;
    &lt;attribute name=&quot;file&quot;/&gt;
    &lt;attribute name=&quot;outputproperty&quot;/&gt;
    &lt;sequential&gt;
        &lt;local name=&quot;file.base&quot;/&gt;
        &lt;basename file=&quot;@{file}&quot; property=&quot;file.base&quot;/&gt;
        &lt;propertyregex property=&quot;@{outputproperty}&quot; input=&quot;${file.base}&quot; regexp=&quot;^(.*)-[0-9].*\.zip&quot; select=&quot;\1&quot; /&gt;
    &lt;/sequential&gt;
&lt;/macrodef&gt;
</code></pre>
<p>To install the plugins, we modify <code>start-external-cluster-with-plugin</code> target:</p>
<pre><code class=language-xml>&lt;target name=&quot;start-external-cluster-with-plugin&quot; depends=&quot;setup-workspace&quot;&gt;
    &lt;install-plugin name=&quot;${project.artifactId}&quot; file=&quot;${project.build.directory}/releases/${project.artifactId}-${project.version}.zip&quot;/&gt;
    &lt;ac:for param=&quot;file&quot;&gt;
        &lt;path&gt;
            &lt;fileset dir=&quot;${project.build.directory}/integration-tests/plugins&quot;/&gt;
        &lt;/path&gt;
        &lt;sequential&gt;
            &lt;local name=&quot;plugin.name&quot;/&gt;
            &lt;convert-plugin-name file=&quot;@{file}&quot; outputproperty=&quot;plugin.name&quot;/&gt;
            &lt;install-plugin name=&quot;${plugin.name}&quot; file=&quot;@{file}&quot;/&gt;
        &lt;/sequential&gt;
    &lt;/ac:for&gt;

    &lt;startup-elasticsearch/&gt;
&lt;/target&gt;
</code></pre>
<p>It executes the following steps:</p>
<ul>
<li>Install the plugin we are currently creating</li>
<li>Install every single plugin which is available in <code>target/integration-tests/plugins</code></li>
<li>Launch elasticsearch</li>
</ul>
<h3 id=authentification>Authentification</h3>
<p>When you install <code>x-pack</code>, your cluster is automatically secured. Well, it can cause
some problems when you run your tests or want to check that the cluster is running.
Because you need to be authenticated.</p>
<p>You could potentially create with ant again a user but fortunately <code>x-pack</code> comes
with a default user <code>elastic</code> and a <code>changeme</code> password, so we just have to use that.</p>
<p>In our ant script, it means that we need to adapt a bit our code:</p>
<pre><code class=language-xml>&lt;macrodef name=&quot;waitfor-elasticsearch&quot;&gt;
    &lt;attribute name=&quot;port&quot;/&gt;
    &lt;attribute name=&quot;timeoutproperty&quot;/&gt;
    &lt;attribute name=&quot;username&quot;/&gt;
    &lt;attribute name=&quot;password&quot;/&gt;
    &lt;sequential&gt;
        &lt;echo&gt;Waiting for elasticsearch to become available on port @{port}...&lt;/echo&gt;
        &lt;waitfor maxwait=&quot;30&quot; maxwaitunit=&quot;second&quot;
                 checkevery=&quot;500&quot; checkeveryunit=&quot;millisecond&quot;
                 timeoutproperty=&quot;@{timeoutproperty}&quot;&gt;
            &lt;socket server=&quot;127.0.0.1&quot; port=&quot;@{port}&quot;/&gt;
        &lt;/waitfor&gt;
        &lt;echo&gt;Elasticsearch is running on port @{port}...&lt;/echo&gt;
        &lt;echo&gt;Check that we can authenticate with user @{username}/@{password}...&lt;/echo&gt;
        &lt;local name=&quot;temp.file&quot;/&gt;
        &lt;tempfile property=&quot;temp.file&quot; destdir=&quot;${java.io.tmpdir}&quot; deleteonexit=&quot;false&quot;/&gt;
        &lt;get src=&quot;http://127.0.0.1:@{port}/&quot; dest=&quot;${temp.file}&quot;
             username=&quot;@{username}&quot; password=&quot;@{password}&quot; verbose=&quot;true&quot; retries=&quot;10&quot; ignoreerrors=&quot;true&quot;/&gt;
        &lt;echo&gt;We can access http://127.0.0.1:@{port}/...&lt;/echo&gt;
    &lt;/sequential&gt;
&lt;/macrodef&gt;
</code></pre>
<p>Then when we call this macro, we pass the username and password:</p>
<pre><code class=language-xml>&lt;local name=&quot;failed.to.start&quot;/&gt;
&lt;waitfor-elasticsearch port=&quot;@{es.http.port}&quot;
                       timeoutproperty=&quot;failed.to.start&quot;
                       username=&quot;${integ.security.username}&quot;
                       password=&quot;${integ.security.password}&quot;
/&gt;
</code></pre>
<p>Which we just have to define in our <code>pom.xml</code> as properties:</p>
<pre><code class=language-xml>&lt;integ.security.username&gt;elastic&lt;/integ.security.username&gt;
&lt;integ.security.password&gt;changeme&lt;/integ.security.password&gt;
</code></pre>
<h2 id=using-rest-authentication>Using REST authentication</h2>
<p>In our <code>AbstractITCase</code>, we need to change how we create our REST client and provide a <code>CredentialsProvider</code>:</p>
<pre><code class=language-java>@BeforeClass
public static void startRestClient() {
    final CredentialsProvider credentialsProvider = new BasicCredentialsProvider();
    credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(&quot;elastic&quot;, &quot;changeme&quot;));

    client = RestClient.builder(new HttpHost(&quot;127.0.0.1&quot;, HTTP_TEST_PORT))
            .setHttpClientConfigCallback(httpClientBuilder -&gt; httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider))
            .build();

    // ...
}
</code></pre>
<p>And&mldr; We&rsquo;re done!</p>
<p>Just run:</p>
<pre><code class=language-sh>mvn install -DskipUnitTests=true
</code></pre>
<p>And see the result.</p>
<p>It will create the plugin ZIP, copy elasticsearch to <code>target/integration-tests/binaries</code> and <code>x-pack</code> to <code>target/integration-tests/plugins</code>:</p>
<pre><code class=language-txt>[INFO] --- maven-assembly-plugin:2.6:single (default) @ ingest-bano ---
[INFO] Reading assembly descriptor: /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/src/main/assemblies/plugin.xml
[INFO] Building zip: /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/releases/ingest-bano-5.0.0-alpha5.zip
[INFO]
[INFO] --- maven-dependency-plugin:2.10:copy (integ-setup-dependencies) @ ingest-bano ---
[INFO] Configured Artifact: org.elasticsearch.distribution.zip:elasticsearch:5.0.0-alpha5:zip
[INFO] org.elasticsearch.distribution.zip:elasticsearch:5.0.0-alpha5:zip already exists in /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/binaries
[INFO]
[INFO] --- maven-dependency-plugin:2.10:copy (integ-setup-dependencies-plugins) @ ingest-bano ---
[INFO] Configured Artifact: org.elasticsearch.plugin:x-pack:5.0.0-alpha5:zip
[INFO] org.elasticsearch.plugin:x-pack:5.0.0-alpha5:zip already exists in /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/plugins
[INFO]
</code></pre>
<p>Then it will unzip elasticsearch, install <code>ingest-bano</code> and <code>x-pack</code>. Then start the cluster:</p>
<pre><code class=language-txt>[INFO] --- maven-antrun-plugin:1.8:run (integ-setup) @ ingest-bano ---
[INFO] Executing tasks

main:

stop-external-cluster:

setup-workspace:
   [delete] Deleting directory /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run
    [unzip] Expanding: /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/binaries/elasticsearch-5.0.0-alpha5.zip into /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run

start-external-cluster-with-plugin:
     [echo] Installing plugin ingest-bano...
    [mkdir] Created dir: /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/tmp/null223436133
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;exec script=&quot;elasticsearch-plugin&quot;&gt;
  &lt;arg value=&quot;install&quot; /&gt;
  &lt;arg value=&quot;file:/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/releases/ingest-bano-5.0.0-alpha5.zip&quot; /&gt;
&lt;/exec&gt;
[elasticsearch-plugin] Plugins directory [/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/elasticsearch-5.0.0-alpha5/plugins] does not exist. Creating...
[elasticsearch-plugin] -&gt; Downloading file:/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/releases/ingest-bano-5.0.0-alpha5.zip
[elasticsearch-plugin]
[elasticsearch-plugin] -&gt; Installed ingest-bano
     [echo] Installing plugin x-pack...
    [mkdir] Created dir: /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/tmp/null463986480
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;exec script=&quot;elasticsearch-plugin&quot;&gt;
  &lt;arg value=&quot;install&quot; /&gt;
  &lt;arg value=&quot;file:/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/plugins/x-pack-5.0.0-alpha5.zip&quot; /&gt;
&lt;/exec&gt;
[elasticsearch-plugin] -&gt; Downloading file:/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/plugins/x-pack-5.0.0-alpha5.zip
[elasticsearch-plugin]
[elasticsearch-plugin] @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[elasticsearch-plugin] @     WARNING: plugin requires additional permissions     @
[elasticsearch-plugin] @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[elasticsearch-plugin] * java.lang.RuntimePermission accessClassInPackage.com.sun.activation.registries
[elasticsearch-plugin] * java.lang.RuntimePermission getClassLoader
[elasticsearch-plugin] * java.lang.RuntimePermission setContextClassLoader
[elasticsearch-plugin] * java.lang.RuntimePermission setFactory
[elasticsearch-plugin] * java.security.SecurityPermission createPolicy.JavaPolicy
[elasticsearch-plugin] * java.security.SecurityPermission getPolicy
[elasticsearch-plugin] * java.security.SecurityPermission putProviderProperty.BC
[elasticsearch-plugin] * java.security.SecurityPermission setPolicy
[elasticsearch-plugin] * java.util.PropertyPermission * read,write
[elasticsearch-plugin] * java.util.PropertyPermission sun.nio.ch.bugLevel write
[elasticsearch-plugin] * javax.net.ssl.SSLPermission setHostnameVerifier
[elasticsearch-plugin] See http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html
[elasticsearch-plugin] for descriptions of what these permissions allow and the associated risks.
[elasticsearch-plugin] -&gt; Installed x-pack
     [echo] Starting up external cluster...
     [echo] running Elasticsearch 5.0.0 or superior
    [mkdir] Created dir: /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/tmp/null1562972688
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;exec script=&quot;elasticsearch&quot;&gt;
  &lt;arg value=&quot;-Epidfile=/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/es.pid&quot; /&gt;
  &lt;arg value=&quot;-Ecluster.name=elasticsearch_integration&quot; /&gt;
  &lt;arg value=&quot;-Ehttp.port=9400&quot; /&gt;
  &lt;arg value=&quot;-Etransport.tcp.port=9500&quot; /&gt;
  &lt;arg value=&quot;-Enetwork.host=127.0.0.1&quot; /&gt;
&lt;/exec&gt;
     [echo] Waiting for elasticsearch to become available on port 9400...
     [echo] Elasticsearch is running on port 9400...
     [echo] Check that we can authenticate with user elastic/changeme...
      [get] Getting: http://127.0.0.1:9400/
      [get] To: /var/folders/r_/r14sy86n2zb91jyz1ptb5b4w0000gn/T/null600789717
.
     [echo] We can access http://127.0.0.1:9400/...
[elasticsearch] [2016-08-03 19:36:57,508][INFO ][node                     ] [] initializing ...
[elasticsearch] [2016-08-03 19:36:57,570][INFO ][env                      ] [hQWaRT2] using [1] data paths, mounts [[/ (/dev/disk1)]], net usable_space [32.5gb], net total_space [464.7gb], spins? [unknown], types [hfs]
[elasticsearch] [2016-08-03 19:36:57,570][INFO ][env                      ] [hQWaRT2] heap size [1.9gb], compressed ordinary object pointers [true]
[elasticsearch] [2016-08-03 19:36:57,571][INFO ][node                     ] [hQWaRT2] node name [hQWaRT2] derived from node ID; set [node.name] to override
[elasticsearch] [2016-08-03 19:36:57,572][INFO ][node                     ] [hQWaRT2] version[5.0.0-alpha5], pid[24989], build[6b7d409/2016-07-29T07:51:41.648Z], OS[Mac OS X/10.11.6/x86_64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_60/25.60-b23]
[elasticsearch] [2016-08-03 19:36:58,569][INFO ][io.netty.util.internal.PlatformDependent] Your platform does not provide complete low-level API for accessing direct buffers reliably. Unless explicitly requested, heap buffer will always be preferred to avoid potential system unstability.
[elasticsearch] [2016-08-03 19:36:58,953][INFO ][xpack.security.crypto    ] [hQWaRT2] system key [/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/elasticsearch-5.0.0-alpha5/config/x-pack/system_key] has been loaded
[elasticsearch] [2016-08-03 19:36:58,970][INFO ][plugins                  ] [hQWaRT2] loaded module [aggs-matrix-stats]
[elasticsearch] [2016-08-03 19:36:58,970][INFO ][plugins                  ] [hQWaRT2] loaded module [ingest-common]
[elasticsearch] [2016-08-03 19:36:58,970][INFO ][plugins                  ] [hQWaRT2] loaded module [lang-expression]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded module [lang-groovy]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded module [lang-mustache]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded module [lang-painless]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded module [percolator]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded module [reindex]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded module [transport-netty3]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded module [transport-netty4]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded plugin [ingest-bano]
[elasticsearch] [2016-08-03 19:36:58,971][INFO ][plugins                  ] [hQWaRT2] loaded plugin [x-pack]
[elasticsearch] [2016-08-03 19:37:02,019][INFO ][node                     ] [hQWaRT2] initialized
[elasticsearch] [2016-08-03 19:37:02,019][INFO ][node                     ] [hQWaRT2] starting ...
[elasticsearch] [2016-08-03 19:37:02,025][WARN ][xpack.security.authc.file] [hQWaRT2] no users found in users file [/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/elasticsearch-5.0.0-alpha5/config/x-pack/users]. use bin/x-pack/users to add users and role mappings
[elasticsearch] [2016-08-03 19:37:02,029][WARN ][xpack.security.authc.file] [hQWaRT2] no entries found in users_roles file [/Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/elasticsearch-5.0.0-alpha5/config/x-pack/users_roles]. use bin/xpack/users to add users and role mappings
[elasticsearch] [2016-08-03 19:37:02,296][INFO ][xpack.security.transport ] [hQWaRT2] publish_address {127.0.0.1:9500}, bound_addresses {127.0.0.1:9500}
[elasticsearch] [2016-08-03 19:37:02,301][WARN ][bootstrap                ] [hQWaRT2] initial heap size [268435456] not equal to maximum heap size [2147483648]; this can cause resize pauses and prevents mlockall from locking the entire heap
[elasticsearch] [2016-08-03 19:37:02,301][WARN ][bootstrap                ] [hQWaRT2] please set [discovery.zen.minimum_master_nodes] to a majority of the number of master eligible nodes in your cluster
[elasticsearch] [2016-08-03 19:37:05,373][INFO ][cluster.service          ] [hQWaRT2] new_master {hQWaRT2}{hQWaRT2TRvW8aYzm4uI51g}{dx2GKBz6QaGaDcbOVnuEqg}{127.0.0.1}{127.0.0.1:9500}, reason: zen-disco-elected-as-master ([0] nodes joined)
[elasticsearch] [2016-08-03 19:37:05,385][INFO ][http                     ] [hQWaRT2] publish_address {127.0.0.1:9400}, bound_addresses {127.0.0.1:9400}
[elasticsearch] [2016-08-03 19:37:05,386][INFO ][node                     ] [hQWaRT2] started
[elasticsearch] [2016-08-03 19:37:05,511][INFO ][gateway                  ] [hQWaRT2] recovered [0] indices into cluster_state
     [echo] External node started PID 24989
[INFO] Executed tasks
[INFO]
</code></pre>
<p>Then it will launch the tests as usual:</p>
<pre><code class=language-txt>[INFO] --- junit4-maven-plugin:2.3.3:junit4 (integration-tests) @ ingest-bano ---
[INFO] &lt;JUnit4&gt; says 今日は! Master seed: 4CB5E1A5F9A89609
Executing 1 suite with 1 JVM.

Started J0 PID(25006@MacBook-Pro-4.local).
Suite: org.elasticsearch.ingest.bano.BanoPluginIT
  1&gt; [2016-08-03 19:37:08,141][WARN ][org.elasticsearch.bootstrap] Unable to lock JVM Memory: error=78, reason=Function not implemented
  1&gt; [2016-08-03 19:37:08,142][WARN ][org.elasticsearch.bootstrap] This can result in part of the JVM being swapped out.
  1&gt; [2016-08-03 19:37:09,127][INFO ][it                       ] Integration tests ready to start... Cluster is running.
OK      0.11s | BanoPluginIT.testPluginIsLoaded
  1&gt; [2016-08-03 19:37:09,243][INFO ][it                       ] Stopping integration tests against an external cluster
Completed [1/1] in 1.40s, 1 test

[INFO] JVM J0:     0.58 ..     2.36 =     1.78s
[INFO] Execution time total: 2.36 sec.
[INFO] Tests summary: 1 suite, 1 test
[INFO]
[INFO] --- maven-antrun-plugin:1.8:run (integ-teardown) @ ingest-bano ---
[INFO] Executing tasks

main:
</code></pre>
<p>And finally it will stop the cluster:</p>
<pre><code class=language-txt>stop-external-cluster:
     [echo] Shutting down external node PID 24989
   [delete] Deleting: /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/integration-tests/run/es.pid
[INFO] Executed tasks
[INFO]
[INFO] --- maven-install-plugin:2.4:install (default-install) @ ingest-bano ---
[INFO] Installing /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/ingest-bano-5.0.0-alpha5.jar to /Users/dpilato/.m2/repository/fr/pilato/elasticsearch/ingest/ingest-bano/5.0.0-alpha5/ingest-bano-5.0.0-alpha5.jar
[INFO] Installing /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/pom.xml to /Users/dpilato/.m2/repository/fr/pilato/elasticsearch/ingest/ingest-bano/5.0.0-alpha5/ingest-bano-5.0.0-alpha5.pom
[INFO] Installing /Users/dpilato/Documents/Elasticsearch/dev/blog-tests/ingest-bano/target/releases/ingest-bano-5.0.0-alpha5.zip to /Users/dpilato/.m2/repository/fr/pilato/elasticsearch/ingest/ingest-bano/5.0.0-alpha5/ingest-bano-5.0.0-alpha5.zip
</code></pre>
<p>Et voilà! :)</p>
<pre><code class=language-txt>[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 21.124 s
[INFO] Finished at: 2016-08-03T19:37:09+02:00
[INFO] Final Memory: 32M/520M
[INFO] ------------------------------------------------------------------------
</code></pre>
</div>
<div class=my-4>
<a href=https://david.pilato.fr/tags/java/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#java</a>
<a href=https://david.pilato.fr/tags/maven/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#maven</a>
<a href=https://david.pilato.fr/tags/ant/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#ant</a>
<a href=https://david.pilato.fr/tags/elasticsearch/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#elasticsearch</a>
<a href=https://david.pilato.fr/tags/plugin/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#plugin</a>
</div>
<div class=py-2>
<div class="flex flex-col md:flex-row items-center my-8">
<a href=https://david.pilato.fr/authors/david-pilato/ class="w-24 h-24 md:mr-4">
<img src=https://david.pilato.fr/authors/david-pilato/david_pilato.png class="w-full bg-primary-bg rounded-full" alt=Avatar>
</a>
<div class="w-full md:w-auto mt-4 md:mt-0">
<a href=https://david.pilato.fr/authors/david-pilato/ class="block font-bold text-lg pb-1 mb-2 border-b">David Pilato</a>
<span class="block pb-2">20+ years of experience, mostly in Java. Living in Cergy, France.</span>
<a href=mailto:david+blog@pilato.fr class=mr-1>
<i class="fas fa-envelope"></i>
</a>
<a href=https://twitter.com/dadoonet class=mr-1>
<i class="fab fa-twitter"></i>
</a>
<a href=https://github.com/dadoonet class=mr-1>
<i class="fab fa-github"></i>
</a>
<a href=https://www.linkedin.com/in/dadoonet/ class=mr-1>
<i class="fab fa-linkedin"></i>
</a>
</div>
</div>
</div>
<div class="flex flex-col md:flex-row md:justify-between -mx-2 mt-4 px-2 pt-4 border-t">
<div>
<span class="block font-bold">Previous</span>
<a href=https://david.pilato.fr/blog/2016-10-16-creating-a-plugin-for-elasticsearch-5-dot-0-using-maven-updated-for-ga/ class=block>Creating a plugin for elasticsearch 5.0 using Maven (Updated for GA)</a>
</div>
<div class="md:text-right mt-4 md:mt-0">
<span class="block font-bold">Next</span>
<a href=https://david.pilato.fr/blog/2016-08-01-creating-elasticsearch-transport-action/ class=block>Creating Elasticsearch Transport Action</a>
</div>
</div>
<script id=utterances src=https://utteranc.es/client.js issue-term=pathname label=💬 comments repo=dadoonet/dadoonet.github.io theme=preferred-color-scheme crossorigin=anonymous async></script>
<script>storageColorScheme=="Light"?document.getElementById('utterances').setAttribute('theme','github-light'):storageColorScheme=="Dark"&&document.getElementById('utterances').setAttribute('theme','github-dark')</script>
</div>
<div class=col-span-2>
<div class="bg-secondary-bg rounded p-6">
<h3 class="text-lg font-semibold mb-4">Series of Posts</h3>
<div class=content>
<a href=https://david.pilato.fr/blog/2016-08-03-elasticsearch-real-integration-tests-with-security-enabled/>Elasticsearch real integration tests with security enabled</a>
<br>
<a href=https://david.pilato.fr/blog/2016-08-01-creating-elasticsearch-transport-action/>Creating Elasticsearch Transport Action</a>
<br>
<a href=https://david.pilato.fr/blog/2016-07-30-adding-a-new-rest-endpoint-to-elasticsearch/>Adding a new REST endpoint to elasticsearch</a>
<br>
<a href=https://david.pilato.fr/blog/2016-07-29-elasticsearch-real-integration-tests/>Elasticsearch real integration tests</a>
<br>
<a href=https://david.pilato.fr/blog/2016-07-28-creating-an-ingest-plugin-for-elasticsearch/>Creating an Ingest plugin for elasticsearch</a>
<br>
<a href=https://david.pilato.fr/blog/2016-07-27-creating-a-plugin-for-elasticsearch-5-dot-0-using-maven/>Creating a plugin for elasticsearch 5.0 using Maven</a>
<br>
</div>
</div>
<div class="sticky top-16 z-10 hidden lg:block px-6 py-4 bg-primary-bg">
<span class="text-lg font-semibold">On This Page</span>
</div>
<div class="sticky-toc hidden lg:block px-6 pb-6">
<nav id=TableOfContents>
<ul>
<li><a href=#copy-the-plugins-from-maven-central>Copy the plugins from maven central</a></li>
<li><a href=#modify-ant-scripts>Modify ANT scripts</a>
<ul>
<li><a href=#install-other-plugins>Install other plugins</a></li>
<li><a href=#authentification>Authentification</a></li>
</ul>
</li>
<li><a href=#using-rest-authentication>Using REST authentication</a></li>
</ul>
</nav>
</div>
<script>window.addEventListener('DOMContentLoaded',()=>{enableStickyToc()})</script>
</div>
<div class="col-span-2 lg:col-span-6 bg-secondary-bg rounded p-6">
<h2 class="text-lg font-semibold mb-4">See Also</h2>
<div class=content>
<a href=https://david.pilato.fr/blog/2016-07-29-elasticsearch-real-integration-tests/>Elasticsearch real integration tests</a>
<br>
<a href=https://david.pilato.fr/blog/2016-07-27-creating-a-plugin-for-elasticsearch-5-dot-0-using-maven/>Creating a plugin for elasticsearch 5.0 using Maven</a>
<br>
<a href=https://david.pilato.fr/blog/2011-09-14-mon-premier-plugin-elasticsearch-rss-river/>Mon premier plugin elasticsearch : RSS River</a>
<br>
<a href=https://david.pilato.fr/blog/2016-08-01-creating-elasticsearch-transport-action/>Creating Elasticsearch Transport Action</a>
<br>
<a href=https://david.pilato.fr/blog/2016-07-30-adding-a-new-rest-endpoint-to-elasticsearch/>Adding a new REST endpoint to elasticsearch</a>
<br>
<a href=https://david.pilato.fr/blog/2016-07-28-creating-an-ingest-plugin-for-elasticsearch/>Creating an Ingest plugin for elasticsearch</a>
<br>
</div>
</div>
</div>
<script>document.addEventListener('DOMContentLoaded',()=>{hljs.initHighlightingOnLoad()})</script>
</div>
</div>
</main>
<footer class=pl-scrollbar>
<div class="w-full max-w-screen-xl mx-auto"><div class="text-center p-6 pin-b">
<p class="text-sm text-tertiary-text">&copy; 2022, David Pilato, France
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p>
</div></div>
</footer>
</body>
</html>