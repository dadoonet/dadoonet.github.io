{{ define "title" }}
{{- .Title -}}
{{ end }}

{{ define "main"}}

<style>
  /* Template cards grid */
  .template-grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(1, 1fr);
  }
  @media (min-width: 640px) {
    .template-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (min-width: 1024px) {
    .template-grid { grid-template-columns: repeat(3, 1fr); }
  }
  @media (min-width: 1280px) {
    .template-grid { grid-template-columns: repeat(4, 1fr); }
  }

  .template-card {
    position: relative;
    border-radius: 1rem;
    overflow: hidden;
    background: oklch(var(--b2));
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
  }
  .template-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
  }
  .template-card-header {
    padding: 1.5rem;
    background: linear-gradient(135deg, oklch(var(--p)) 0%, oklch(var(--s)) 100%);
    color: oklch(var(--pc));
  }
  .template-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    line-height: 1.3;
    margin: 0;
  }
  .template-card-body {
    padding: 1rem 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .template-card-abstract {
    color: oklch(var(--bc) / 0.7);
    font-size: 0.9rem;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    flex: 1;
  }
  .template-card-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid oklch(var(--bc) / 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.5rem;
  }
  .template-stat {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.85rem;
    color: oklch(var(--bc) / 0.6);
  }
  .template-stat ion-icon {
    font-size: 1rem;
  }
  .template-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 1.5rem;
    height: 1.5rem;
    padding: 0 0.5rem;
    font-size: 0.75rem;
    font-weight: 700;
    border-radius: 9999px;
    background: oklch(var(--p));
    color: oklch(var(--pc));
  }
  .template-date {
    font-size: 0.8rem;
    color: oklch(var(--bc) / 0.5);
  }

  /* Section divider */
  .section-divider {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin: 2rem 0;
  }
  .section-divider::before,
  .section-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, transparent, oklch(var(--p) / 0.3), transparent);
  }
  .section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: oklch(var(--bc));
    white-space: nowrap;
  }
</style>

{{/* Get all template pages from this section */}}
{{ $templates := .Pages }}

{{/* Sort templates by date descending (most recent first) */}}
{{ $sortedTemplates := sort $templates ".Date" "desc" }}

<div id="top" class="mt-8 px-4" style="padding-left: 2rem; padding-right: 2rem;">
  <div style="max-width: 1600px; margin: 0 auto;">
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold tracking-tight">
        <ion-icon name="albums" class="text-primary align-middle"></ion-icon>
        {{ default "Talk Templates" .Title }}
      </h1>
      <p class="text-base-content/70 mt-4 max-w-2xl mx-auto">{{ len $sortedTemplates }} talk templates available</p>
    </div>

    <div class="template-grid">
      {{ range $sortedTemplates }}
      {{ $talkName := .Params.talk }}
      {{/* Count how many times this talk was played */}}
      {{ $playedCount := 0 }}
      {{ $latestDate := .Date }}
      {{ range where (where site.RegularPages "Section" "talks") ".Params.talk" $talkName }}
        {{ $playedCount = add $playedCount 1 }}
        {{ if gt .Date $latestDate }}
          {{ $latestDate = .Date }}
        {{ end }}
      {{ end }}

      <a href="{{ .RelPermalink }}" class="template-card">
        <div class="template-card-header">
          <h2 class="template-card-title">{{ .Title }}</h2>
        </div>
        <div class="template-card-body">
          <p class="template-card-abstract">{{ .Summary | plainify | truncate 150 }}</p>
        </div>
        <div class="template-card-footer">
          <div class="template-stat">
            <ion-icon name="mic"></ion-icon>
            <span>Played <span class="template-badge">{{ $playedCount }}</span> times</span>
          </div>
          <span class="template-date">Since {{ .Date | time.Format "Jan 2006" }}</span>
        </div>
      </a>
      {{ end }}
    </div>

  </div>
</div>

{{ end }}

